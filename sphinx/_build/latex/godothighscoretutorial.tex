%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsable pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}



\usepackage{tgtermes}
\usepackage{tgheros}
\renewcommand{\ttdefault}{txtt}



\usepackage[Bjarne]{fncychap}
\usepackage{sphinx}

\fvset{fontsize=auto}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}


\usepackage{sphinxmessages}




\title{Godot Highscore Tutorial}
\date{Jul 14, 2021}
\release{}
\author{Richard Smith}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}



\chapter{High Score Tables}
\label{\detokenize{tutorial:high-score-tables}}\label{\detokenize{tutorial::doc}}
\sphinxAtStartPar
This tutorial will show you how to add a locally saved high score table
to your game. (The next tutorial will show you how to add an online
leaderboard to your game.)

\sphinxAtStartPar
If you already have a game you should be able to apply the tutorial to
it. Alternatively, I have provided a very simple game which you can
download, import into Godot and use.

\sphinxAtStartPar
Links:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxhref{https://electronstudio.github.io/godot\_high\_scores\_tutorial}{View finished
project}

\item {} 
\sphinxAtStartPar
\sphinxhref{https://electronstudio.github.io/godot\_high\_scores\_tutorial/godot\_high\_scores\_starter\_version.zip}{Download starter
project}

\end{itemize}


\section{The simple game}
\label{\detokenize{tutorial:the-simple-game}}
\sphinxAtStartPar
Before we start adding anything we will look at what the simple game
already has and how it works. (This section is for information; you
don’t have to do anything until the next section.)

\sphinxAtStartPar
Our game only has 2 scenes:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleemphasis{title\_screen.tscn}

\item {} 
\sphinxAtStartPar
\sphinxstyleemphasis{game.tscn}

\end{itemize}

\sphinxAtStartPar
The code for this is very simple:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{func} \PYG{n}{\PYGZus{}on\PYGZus{}QuitButton\PYGZus{}pressed}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{get\PYGZus{}tree}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{quit}\PYG{p}{(}\PYG{p}{)}

\PYG{k}{func} \PYG{n}{\PYGZus{}on\PYGZus{}PlayButton\PYGZus{}pressed}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{get\PYGZus{}tree}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{change\PYGZus{}scene}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{res://game.tscn}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
These functions are connected to the buttons via signals. Note there is
no function for the high score button yet.

\sphinxAtStartPar
The game scene has only 4 nodes:
\begin{itemize}
\item {} 
\sphinxAtStartPar
A label to display the time

\item {} 
\sphinxAtStartPar
A label to display the score

\item {} 
\sphinxAtStartPar
A timer

\item {} 
\sphinxAtStartPar
An icon (sprite)

\end{itemize}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{gamescreen_nodes}.png}
\caption{game scene nodes}\label{\detokenize{tutorial:id1}}\end{figure}

\sphinxAtStartPar
The code simply counts down the timer every second, and increases the
score every time a key is pressed:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{var} \PYG{n}{time} \PYG{o}{=} \PYG{l+m+mi}{10}
\PYG{k}{var} \PYG{n}{score} \PYG{o}{=} \PYG{l+m+mi}{0}

\PYG{k}{func} \PYG{n}{\PYGZus{}on\PYGZus{}Timer\PYGZus{}timeout}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{time} \PYG{o}{\PYGZhy{}=} \PYG{l+m+mi}{1}
    \PYG{o}{\PYGZdl{}}\PYG{n}{TimeLabel}\PYG{o}{.}\PYG{n}{text} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{TIME: }\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{+}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{time}\PYG{p}{)}
    \PYG{k}{if} \PYG{n}{time} \PYG{o}{\PYGZlt{}}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{:}
        \PYG{n}{get\PYGZus{}tree}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{change\PYGZus{}scene}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{res://title\PYGZus{}screen.tscn}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{k}{func} \PYG{n}{\PYGZus{}unhandled\PYGZus{}input}\PYG{p}{(}\PYG{n}{event}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if} \PYG{n}{event} \PYG{k}{is} \PYG{n}{InputEventKey} \PYG{o+ow}{and} \PYG{o+ow}{not} \PYG{n}{event}\PYG{o}{.}\PYG{n}{echo}\PYG{p}{:}
        \PYG{n}{score} \PYG{o}{+=} \PYG{l+m+mi}{1}
        \PYG{o}{\PYGZdl{}}\PYG{n}{ScoreLabel}\PYG{o}{.}\PYG{n}{text} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SCORE: }\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{+}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{score}\PYG{p}{)}
        \PYG{o}{\PYGZdl{}}\PYG{n}{icon}\PYG{o}{.}\PYG{n}{position}\PYG{o}{.}\PYG{n}{y} \PYG{o}{=} \PYG{n}{score} \PYG{o}{*} \PYG{l+m+mi}{5}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{gamescreen}.png}
\caption{The game screen}\label{\detokenize{tutorial:id2}}\end{figure}


\section{Game Over Screen}
\label{\detokenize{tutorial:game-over-screen}}
\sphinxAtStartPar
We need somewhere for the player to enter his name, so let’s make a
‘Game Over’ screen that will be displayed when the game ends.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Create a new scene. \sphinxincludegraphics{{newscene}.png}

\item {} 
\sphinxAtStartPar
Select \sphinxstyleemphasis{User Interface} for the root node.

\end{enumerate}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{userinterface}.png}
\caption{Select User Interface for root node}\label{\detokenize{tutorial:id3}}\end{figure}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{2}
\item {} 
\sphinxAtStartPar
Right click the root node \sphinxstylestrong{Control} and rename it to \sphinxcode{\sphinxupquote{gameover}}.

\item {} 
\sphinxAtStartPar
Press ctrl+S keys and save the scene as \sphinxcode{\sphinxupquote{gameover.tscn}}.

\item {} 
\sphinxAtStartPar
Add a \sphinxstylestrong{Label} child node to the root node.
\begin{itemize}
\item {} 
\sphinxAtStartPar
In the Inspector, click \sphinxstyleemphasis{Custom Fonts} and then drag the
\sphinxstylestrong{font.tres} file from the FileSystem (bottom left of screen)
into the \sphinxstylestrong{{[}empty{]}} font field.

\item {} 
\sphinxAtStartPar
In the Inspector, enter into the \sphinxstyleemphasis{Text} field

\end{itemize}

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{GAMEOVER}

\PYG{n}{Your} \PYG{n}{score} \PYG{o+ow}{is}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{5}
\item {} 
\sphinxAtStartPar
Add a second \sphinxstylestrong{Label} child node to the root node.
\begin{itemize}
\item {} 
\sphinxAtStartPar
Rename it to \sphinxcode{\sphinxupquote{score}}.

\item {} 
\sphinxAtStartPar
In the Inspector, enter into the \sphinxstyleemphasis{Text} field: \sphinxstylestrong{0}.

\item {} 
\sphinxAtStartPar
In the Inspector, click \sphinxstyleemphasis{Custom Fonts} and then drag the
\sphinxstylestrong{font.tres} file from the FileSystem (bottom left of screen)
into the \sphinxstylestrong{{[}empty{]}} font field.

\end{itemize}

\item {} 
\sphinxAtStartPar
Add a \sphinxstylestrong{LineEdit} child node to the root node.
\begin{itemize}
\item {} 
\sphinxAtStartPar
In the Inspector, click \sphinxstyleemphasis{Custom Fonts} and then drag the
\sphinxstylestrong{font.tres} file from the FileSystem (bottom left of screen)
into the \sphinxstylestrong{{[}empty{]}} font field.

\end{itemize}

\item {} 
\sphinxAtStartPar
Drag things around until it looks something like this:

\end{enumerate}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{gameover}.png}
\caption{Gameover scene}\label{\detokenize{tutorial:id4}}\end{figure}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{8}
\item {} 
\sphinxAtStartPar
Edit the script file \sphinxstylestrong{game.gd}.
\begin{itemize}
\item {} 
\sphinxAtStartPar
Change \sphinxcode{\sphinxupquote{"res://title\_screen.tscn"}} to \sphinxcode{\sphinxupquote{"res://gameover.tscn"}}
so that the game goes to the gameover screen at the end.

\end{itemize}

\end{enumerate}


\section{Global variables}
\label{\detokenize{tutorial:global-variables}}
\sphinxAtStartPar
We have a problem: we want to display the score on the Game Over screen,
but the score is only stored in the \sphinxstylestrong{game.gd} script, not the
\sphinxstylestrong{gameover.gd} one.

\sphinxAtStartPar
In Python (and Godot) we saw \sphinxstyleemphasis{global} variables that can be used from
any function in one script. In Python if we want to use a variable from
another script we have to import it.

\sphinxAtStartPar
In Godot we can do something similar but it’s easier to create variables
that can be used by \sphinxstyleemphasis{any} script in \sphinxstyleemphasis{any} scene by creating a \sphinxstyleemphasis{singleton
object}. Let’s do this.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Create a new script. It won’t be attached to a node, so we have to go
to the script editor and click \sphinxstyleemphasis{File} menu, then \sphinxstylestrong{New Script}.
Enter \sphinxcode{\sphinxupquote{globals.gd}} as the name of the script and press \sphinxstylestrong{create}.

\item {} 
\sphinxAtStartPar
Add a score variable to the bottom of the script:

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{var} \PYG{n}{score}\PYG{o}{=}\PYG{l+m+mi}{0}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{2}
\item {} 
\sphinxAtStartPar
Save the script. (ctrl\sphinxhyphen{}S)

\item {} 
\sphinxAtStartPar
To make this accessible from anywhere:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Click \sphinxstyleemphasis{Project} menu, then \sphinxstyleemphasis{Project Settings}, then \sphinxstyleemphasis{AutoLoad}.

\item {} 
\sphinxAtStartPar
Click the small folder icon and select the \sphinxstyleemphasis{globals.gd} script.
Press \sphinxstyleemphasis{open}.

\item {} 
\sphinxAtStartPar
Press \sphinxstyleemphasis{Add}. Then \sphinxstyleemphasis{Close}.

\end{itemize}

\item {} 
\sphinxAtStartPar
Now go back the \sphinxstyleemphasis{game.gd} script and delete the line containing the
score variable (line 5). Then change all the other references from
\sphinxcode{\sphinxupquote{score}} to \sphinxcode{\sphinxupquote{Globals.score}}.

\sphinxAtStartPar
The end result should look like this:

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{extends} \PYG{n}{Node2D}

\PYG{k}{var} \PYG{n}{time} \PYG{o}{=} \PYG{l+m+mi}{10}

\PYG{k}{func} \PYG{n}{\PYGZus{}on\PYGZus{}Timer\PYGZus{}timeout}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
   \PYG{n}{time} \PYG{o}{\PYGZhy{}=} \PYG{l+m+mi}{1}
   \PYG{o}{\PYGZdl{}}\PYG{n}{TimeLabel}\PYG{o}{.}\PYG{n}{text} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{TIME: }\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{+}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{time}\PYG{p}{)}
   \PYG{k}{if} \PYG{n}{time} \PYG{o}{\PYGZlt{}}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{:}
      \PYG{n}{get\PYGZus{}tree}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{change\PYGZus{}scene}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{res://gameover.tscn}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{k}{func} \PYG{n}{\PYGZus{}unhandled\PYGZus{}input}\PYG{p}{(}\PYG{n}{event}\PYG{p}{)}\PYG{p}{:}
   \PYG{k}{if} \PYG{n}{event} \PYG{k}{is} \PYG{n}{InputEventKey} \PYG{o+ow}{and} \PYG{o+ow}{not} \PYG{n}{event}\PYG{o}{.}\PYG{n}{echo}\PYG{p}{:}
      \PYG{n}{Globals}\PYG{o}{.}\PYG{n}{score} \PYG{o}{+=} \PYG{l+m+mi}{1}
      \PYG{o}{\PYGZdl{}}\PYG{n}{ScoreLabel}\PYG{o}{.}\PYG{n}{text} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SCORE: }\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{+}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{Globals}\PYG{o}{.}\PYG{n}{score}\PYG{p}{)}
      \PYG{o}{\PYGZdl{}}\PYG{n}{icon}\PYG{o}{.}\PYG{n}{position}\PYG{o}{.}\PYG{n}{y} \PYG{o}{=} \PYG{n}{Globals}\PYG{o}{.}\PYG{n}{score} \PYG{o}{*} \PYG{l+m+mi}{5}
\end{sphinxVerbatim}

\sphinxAtStartPar
You don’t need to type all that, you only need to make 4 edits. But
that’s the complete file you should have after your changes.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{5}
\item {} 
\sphinxAtStartPar
Let’s see if we can access the score from the gameover screen now. Go
to the \sphinxstylestrong{gameover.tscn} scene. Right click on the root node and
\sphinxstylestrong{attach script}. Press \sphinxstylestrong{create}. Edit ready function (delete the
\sphinxcode{\sphinxupquote{pass}}) so that it looks like this:

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{func} \PYG{n}{\PYGZus{}ready}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{o}{\PYGZdl{}}\PYG{n}{score}\PYG{o}{.}\PYG{n}{text} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{Globals}\PYG{o}{.}\PYG{n}{score}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{6}
\item {} 
\sphinxAtStartPar
Now run the game and test that your score is indeed displayed.

\end{enumerate}
\begin{quote}

\sphinxAtStartPar
Why did we have to use the \sphinxcode{\sphinxupquote{str()}} function here? What happens if
you do \sphinxcode{\sphinxupquote{\$score.text = Globals.score}} instead?
\end{quote}


\section{Storing the names}
\label{\detokenize{tutorial:storing-the-names}}
\sphinxAtStartPar
Before we can display the table we need somewhere to store the scores
and the names, so let’s add two lists to the end of the \sphinxstylestrong{globals.gd}
script:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{var} \PYG{n}{scores} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{var} \PYG{n}{names} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\end{sphinxVerbatim}

\sphinxAtStartPar
Go back to \sphinxstylestrong{gameover.tscn} scene and click on the \sphinxstylestrong{LineEdit} node.
This is where the name is entered.

\sphinxAtStartPar
Click on \sphinxstyleemphasis{Node} to the right of the \sphinxstyleemphasis{Inspector} to view the \sphinxstyleemphasis{Signals}.
Double click on \sphinxstylestrong{text\_entered}. Press \sphinxstylestrong{connect}.

\sphinxAtStartPar
A function will be created for you that is called when the player enters
his name and presses return. Edit the function to look like this:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{func} \PYG{n}{\PYGZus{}on\PYGZus{}LineEdit\PYGZus{}text\PYGZus{}entered}\PYG{p}{(}\PYG{n}{new\PYGZus{}text}\PYG{p}{)}\PYG{p}{:}
   \PYG{n}{Globals}\PYG{o}{.}\PYG{n}{scores}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{Globals}\PYG{o}{.}\PYG{n}{score}\PYG{p}{)}
   \PYG{n}{Globals}\PYG{o}{.}\PYG{n}{names}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{new\PYGZus{}text}\PYG{p}{)}
   \PYG{n}{get\PYGZus{}tree}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{change\PYGZus{}scene}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{res://score\PYGZus{}table.tscn}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}


\section{Displaying the high score table}
\label{\detokenize{tutorial:displaying-the-high-score-table}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Create a new scene.

\item {} 
\sphinxAtStartPar
Select \sphinxstylestrong{User Interface} for the root node.

\item {} 
\sphinxAtStartPar
Rename the root node to \sphinxcode{\sphinxupquote{ScoreTable}}.

\item {} 
\sphinxAtStartPar
Save the scene as \sphinxcode{\sphinxupquote{score\_table.tscn}}.

\item {} 
\sphinxAtStartPar
Add a \sphinxstylestrong{Label} child node to the root node.
\begin{itemize}
\item {} 
\sphinxAtStartPar
Rename it to \sphinxcode{\sphinxupquote{Names}}

\item {} 
\sphinxAtStartPar
In the Inspector, click \sphinxstyleemphasis{Custom Fonts} and then drag the
\sphinxstylestrong{font.tres} file from the FileSystem (bottom left of screen)
into the \sphinxstylestrong{{[}empty{]}} font field.

\end{itemize}

\item {} 
\sphinxAtStartPar
Add a \sphinxstylestrong{Label} child node to the root node.
\begin{itemize}
\item {} 
\sphinxAtStartPar
Rename it to \sphinxcode{\sphinxupquote{Scores}}

\item {} 
\sphinxAtStartPar
In the Inspector, click \sphinxstyleemphasis{Custom Fonts} and then drag the
\sphinxstylestrong{font.tres} file from the FileSystem (bottom left of screen)
into the \sphinxstylestrong{{[}empty{]}} font field.

\end{itemize}

\item {} 
\sphinxAtStartPar
Position the two labels side by side like this:

\sphinxAtStartPar
\sphinxincludegraphics[width=0.500\linewidth]{{tablenames}.png} \sphinxincludegraphics[width=0.500\linewidth]{{tablescores}.png}

\item {} 
\sphinxAtStartPar
Right click on the root node and \sphinxstyleemphasis{Attach script}. Press \sphinxstyleemphasis{create}.
Edit the \sphinxstyleemphasis{ready} function so that it looks like this:

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{func} \PYG{n}{\PYGZus{}ready}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{name} \PYG{o+ow}{in} \PYG{n}{Globals}\PYG{o}{.}\PYG{n}{names}\PYG{p}{:}
        \PYG{o}{\PYGZdl{}}\PYG{n}{Names}\PYG{o}{.}\PYG{n}{text} \PYG{o}{+=} \PYG{n}{name} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{k}{for} \PYG{n}{score} \PYG{o+ow}{in} \PYG{n}{Globals}\PYG{o}{.}\PYG{n}{scores}\PYG{p}{:}
        \PYG{o}{\PYGZdl{}}\PYG{n}{Scores}\PYG{o}{.}\PYG{n}{text} \PYG{o}{+=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{score}\PYG{p}{)}\PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdq{}}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{8}
\item {} 
\sphinxAtStartPar
Run the game and test.

\end{enumerate}

\sphinxAtStartPar
You should be able to enter your score and see the score table. However,
you will then be stuck because there is no menu navigation.


\section{Menu navigation}
\label{\detokenize{tutorial:menu-navigation}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Open the \sphinxstylestrong{score\_table.tcns} scene.

\item {} 
\sphinxAtStartPar
Add a \sphinxstylestrong{Button} child node to the root node.

\end{enumerate}
\begin{itemize}
\item {} 
\sphinxAtStartPar
Rename it to \sphinxcode{\sphinxupquote{BackButton}} In the Inspector set the \sphinxstylestrong{Text} to
\sphinxcode{\sphinxupquote{Back}}.

\item {} 
\sphinxAtStartPar
In the Inspector, click \sphinxstyleemphasis{Custom Fonts} and then drag the
\sphinxstylestrong{font.tres} file from the FileSystem (bottom left of screen) into
the \sphinxstylestrong{{[}empty{]}} font field.

\sphinxAtStartPar
\sphinxincludegraphics[width=0.700\linewidth]{{autoload}.png}

\end{itemize}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{2}
\item {} 
\sphinxAtStartPar
Click on \sphinxstyleemphasis{Node} to the right of the \sphinxstyleemphasis{Inspector} to view the
\sphinxstyleemphasis{Signals}. Double click on \sphinxstylestrong{pressed}. Press \sphinxstylestrong{connect}.

\item {} 
\sphinxAtStartPar
Edit the function so that it looks like this:

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{func} \PYG{n}{\PYGZus{}on\PYGZus{}BackButton\PYGZus{}pressed}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
   \PYG{n}{get\PYGZus{}tree}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{change\PYGZus{}scene}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{res://title\PYGZus{}screen.tscn}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{4}
\item {} 
\sphinxAtStartPar
Now go to the \sphinxstylestrong{title\_screen.tscn} scene.

\item {} 
\sphinxAtStartPar
Click on the \sphinxstylestrong{HighScoresButton} node. Click on \sphinxstyleemphasis{Node} to the right
of the \sphinxstyleemphasis{Inspector} to view the \sphinxstyleemphasis{Signals}. Double click on
\sphinxstylestrong{pressed}. Press \sphinxstylestrong{connect}.

\item {} 
\sphinxAtStartPar
Edit the function so that it looks like this:

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{func} \PYG{n}{\PYGZus{}on\PYGZus{}HighScoresButton\PYGZus{}pressed}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{get\PYGZus{}tree}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{change\PYGZus{}scene}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{res://score\PYGZus{}table.tscn}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{7}
\item {} 
\sphinxAtStartPar
Well done! You now have a (sort of) working high score table! Try it
out.

\end{enumerate}


\section{Challenge: fix the bug}
\label{\detokenize{tutorial:challenge-fix-the-bug}}
\sphinxAtStartPar
We have accidentally introduced a bug into the game that happens when
you play two or more games in a row without quitting. What is the bug?

\sphinxAtStartPar
How can you fix it?


\section{Saving files}
\label{\detokenize{tutorial:saving-files}}
\sphinxAtStartPar
There a couple of big problems with this score table. The first one is
that it loses the scores every time you quit game.

\sphinxAtStartPar
To fix this, we can store the scores in a file on the computer’s disk.
We will create separate functions for loading and saving the scores.
Edit \sphinxstylestrong{globals.gd} and add this code to the bottom:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{func} \PYG{n}{\PYGZus{}init}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
   \PYG{n}{load\PYGZus{}scores}\PYG{p}{(}\PYG{p}{)}

\PYG{k}{func} \PYG{n}{save\PYGZus{}scores}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{var} \PYG{n}{file} \PYG{o}{=} \PYG{n}{File}\PYG{o}{.}\PYG{n}{new}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{file}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{user://game.dat}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{File}\PYG{o}{.}\PYG{n}{WRITE}\PYG{p}{)}
    \PYG{n}{file}\PYG{o}{.}\PYG{n}{store\PYGZus{}var}\PYG{p}{(}\PYG{n}{names}\PYG{p}{)}
    \PYG{n}{file}\PYG{o}{.}\PYG{n}{store\PYGZus{}var}\PYG{p}{(}\PYG{n}{scores}\PYG{p}{)}
    \PYG{n}{file}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}

\PYG{k}{func} \PYG{n}{load\PYGZus{}scores}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{var} \PYG{n}{file} \PYG{o}{=} \PYG{n}{File}\PYG{o}{.}\PYG{n}{new}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{var} \PYG{n}{err} \PYG{o}{=} \PYG{n}{file}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{user://game.dat}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{File}\PYG{o}{.}\PYG{n}{READ}\PYG{p}{)}
    \PYG{k}{if} \PYG{n}{err} \PYG{o}{!=} \PYG{n}{OK}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{error loading scores}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{names} \PYG{o}{=} \PYG{n}{file}\PYG{o}{.}\PYG{n}{get\PYGZus{}var}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{scores} \PYG{o}{=} \PYG{n}{file}\PYG{o}{.}\PYG{n}{get\PYGZus{}var}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{file}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
The first time we run the game there will be no score file, so we will
we print an error, but this is OK, because it will be created when we
save the scores. To do this, edit \sphinxstylestrong{gameover.gd}, and insert the one
new line highlighted below:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{func} \PYG{n}{\PYGZus{}on\PYGZus{}LineEdit\PYGZus{}text\PYGZus{}entered}\PYG{p}{(}\PYG{n}{new\PYGZus{}text}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{Globals}\PYG{o}{.}\PYG{n}{scores}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{Globals}\PYG{o}{.}\PYG{n}{score}\PYG{p}{)}
    \PYG{n}{Globals}\PYG{o}{.}\PYG{n}{names}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{new\PYGZus{}text}\PYG{p}{)}
    \PYG{n}{Globals}\PYG{o}{.}\PYG{n}{save\PYGZus{}scores}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{get\PYGZus{}tree}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{change\PYGZus{}scene}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{res://score\PYGZus{}table.tscn}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
Run the game and check your scores load and save.


\section{Challenge: Default scores}
\label{\detokenize{tutorial:challenge-default-scores}}
\sphinxAtStartPar
The first time you play the game, the score table is empty. Could you
add some default scores in the code to fill it?


\section{Advanced Challenge (optional!): Improve the organisation of the code.}
\label{\detokenize{tutorial:advanced-challenge-optional-improve-the-organisation-of-the-code}}
\sphinxAtStartPar
Change the above function to be:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{func} \PYG{n}{\PYGZus{}on\PYGZus{}LineEdit\PYGZus{}text\PYGZus{}entered}\PYG{p}{(}\PYG{n}{new\PYGZus{}text}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{Globals}\PYG{o}{.}\PYG{n}{add\PYGZus{}score}\PYG{p}{(}\PYG{n}{new\PYGZus{}text}\PYG{p}{)}
    \PYG{n}{get\PYGZus{}tree}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{change\PYGZus{}scene}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{res://score\PYGZus{}table.tscn}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
Then write the \sphinxcode{\sphinxupquote{add\_score}} function in \sphinxcode{\sphinxupquote{globals.gd}} to make this
work.

\sphinxAtStartPar
(If you attempt this challenge but do not complete it, remember to undo
the changes you made to the \sphinxstyleemphasis{on\_LineEdit\_text\_entered} function.)


\section{Sorting the scores}
\label{\detokenize{tutorial:sorting-the-scores}}
\sphinxAtStartPar
Currently, the scores are not displayed in the correct order. We need to
sort them.

\sphinxAtStartPar
Godot has a built\sphinxhyphen{}in sort function, so we could call \sphinxcode{\sphinxupquote{scores.sort()}},
but this would only sort the scores and not the names. The way a
professional coder would deal with this would probably be to store the
name and score in an object and write a comparator function. However,
it’s more educational (and simpler) for us to just write our own sort
function. (Not to mention that Godot’s support for object\sphinxhyphen{}oriented
programming is frustratingly rudimentary!)

\sphinxAtStartPar
This is a famous algorithm called \sphinxhref{https://en.wikipedia.org/wiki/Bubble\_sort}{Bubble
Sort}.

\sphinxAtStartPar
Add this to the bottom of \sphinxstylestrong{globals.gd}:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{func} \PYG{n}{bubble\PYGZus{}sort}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{passnum} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{len}\PYG{p}{(}\PYG{n}{scores}\PYG{p}{)}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{passnum}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{if} \PYG{n}{scores}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{o}{\PYGZlt{}}\PYG{n}{scores}\PYG{p}{[}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{:}
                \PYG{k}{var} \PYG{n}{temp} \PYG{o}{=} \PYG{n}{scores}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}
                \PYG{n}{scores}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]} \PYG{o}{=} \PYG{n}{scores}\PYG{p}{[}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{]}
                \PYG{n}{scores}\PYG{p}{[}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{=} \PYG{n}{temp}
                \PYG{n}{temp} \PYG{o}{=} \PYG{n}{names}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}
                \PYG{n}{names}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]} \PYG{o}{=} \PYG{n}{names}\PYG{p}{[}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{]}
                \PYG{n}{names}\PYG{p}{[}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{=} \PYG{n}{temp}
\end{sphinxVerbatim}

\sphinxAtStartPar
Edit the \sphinxstylestrong{save\_scores} function so that it sorts every time it saves
(new line highlighted)

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{func} \PYG{n}{save\PYGZus{}scores}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{bubble\PYGZus{}sort}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{var} \PYG{n}{file} \PYG{o}{=} \PYG{n}{File}\PYG{o}{.}\PYG{n}{new}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{file}\PYG{o}{.}\PYG{n}{open}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{user://game.dat}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{File}\PYG{o}{.}\PYG{n}{WRITE}\PYG{p}{)}
    \PYG{n}{file}\PYG{o}{.}\PYG{n}{store\PYGZus{}var}\PYG{p}{(}\PYG{n}{names}\PYG{p}{)}
    \PYG{n}{file}\PYG{o}{.}\PYG{n}{store\PYGZus{}var}\PYG{p}{(}\PYG{n}{scores}\PYG{p}{)}
    \PYG{n}{file}\PYG{o}{.}\PYG{n}{close}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}


\section{Challenge: Sorting}
\label{\detokenize{tutorial:challenge-sorting}}
\sphinxAtStartPar
This bubble sort is not optimized. Make it \sphinxcode{\sphinxupquote{return}} as soon as it
completes a pass with no swaps.

\sphinxAtStartPar
Implement some better sorting algorithms, such as \sphinxhref{https://en.wikipedia.org/wiki/Merge\_sort}{Merge
Sort} and \sphinxhref{https://en.wikipedia.org/wiki/Insertion\_sort}{Insertion
Sort}


\section{More things to try}
\label{\detokenize{tutorial:more-things-to-try}}
\sphinxAtStartPar
Add an ‘OK’ button on the gameover screen.

\sphinxAtStartPar
Display ranking number 1, 2, 3, etc next to the names.

\sphinxAtStartPar
What do you do when there are too many scores to fit on the screen?
Delete the lowest ones? Or provide buttons to scroll up and down?


\chapter{Online leaderboards}
\label{\detokenize{tutorial:online-leaderboards}}
\sphinxAtStartPar
Saving to a local file is very useful, but if you want to compare your
scores with your friends? You can’t read files saved to your friends’
computers, so instead you need to store all the scores on a computer on
the Internet. This is called a \sphinxstyleemphasis{server}. Then as well as saving your
score locally, you also send it to the server, like this:

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=0.800\linewidth]{{server1}.png}
\caption{Sending the high score}\label{\detokenize{tutorial:id5}}\end{figure}

\sphinxAtStartPar
The server saves your score along with all the scores of everybody else.
Then when you want to display the scores, you send a request to the
server to retrieve them:

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=0.600\linewidth]{{server2}.png}
\caption{Requesting the high scores}\label{\detokenize{tutorial:id6}}\end{figure}

\sphinxAtStartPar
Usually I would not suggest relying on third party servers for your
game.
\begin{quote}

\sphinxAtStartPar
If you use a third party leaderboard service, what will the effect on
your game be if it is not running? Do you think it will still be
running five years from now?
\end{quote}

\sphinxAtStartPar
However the \sphinxstyleemphasis{dreamlo} server is very simple, so if it does stop running
it will not be difficult for us to create our own replacement. (That
would would be the topic for another tutorial. For now we will use
\sphinxstyleemphasis{dreamlo}).


\section{Dreamlo sign\sphinxhyphen{}up}
\label{\detokenize{tutorial:dreamlo-sign-up}}
\sphinxAtStartPar
In your web browser, go to the website
\sphinxhref{http://dreamlo.com/}{dreamlo.com}.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=0.700\linewidth]{{dreamlo1}.png}
\caption{dreamlo website}\label{\detokenize{tutorial:id7}}\end{figure}

\sphinxAtStartPar
Click \sphinxstylestrong{Get Yours Now} button.

\sphinxAtStartPar
In Godot, open \sphinxstylestrong{globals.gd}. Add these two variables, but \sphinxstylestrong{rather
than using my values, copy and paste the codes given to you on the left
side of the web page.}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{var} \PYG{n}{public\PYGZus{}code} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{60d206118f40bb114c4ca743}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{k}{var} \PYG{n}{private\PYGZus{}code} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{iRJrbvqSmkykd5aQBcXlAgm6EWSo3SekmWhWF5W\PYGZhy{}zfkA}\PYG{l+s+s2}{\PYGZdq{}}
\end{sphinxVerbatim}


\section{Submitting scores manually}
\label{\detokenize{tutorial:submitting-scores-manually}}
\sphinxAtStartPar
Copy this URL into a new web browser window and press enter, but replace
the code with your \sphinxstyleemphasis{private} code. (You can see this example on your
private dreamlo page with the correct code already filled in)

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{http}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{n}{dreamlo}\PYG{o}{.}\PYG{n}{com}\PYG{o}{/}\PYG{n}{lb}\PYG{o}{/}\PYG{n}{Sv3NeBzS0016IwMfZjGudTESQhkHwEpQ}\PYG{o}{/}\PYG{n}{add}\PYG{o}{/}\PYG{n}{Carmine}\PYG{o}{/}\PYG{l+m+mi}{100}
\end{sphinxVerbatim}

\sphinxAtStartPar
\sphinxincludegraphics[width=0.750\linewidth]{{dreamlo3}.png}

\sphinxAtStartPar
You should get a response that says \sphinxstyleemphasis{OK} or similar. You have submitted
the score of 100 for player Carmine. Go ahead and submit a few more
scores for other players.

\sphinxAtStartPar
To test if it worked, copy this URL and press enter but replace the code
with your \sphinxstyleemphasis{private} code. (You can see this example on the dreamlo page
with the correct code already filled in.)

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{http}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{n}{dreamlo}\PYG{o}{.}\PYG{n}{com}\PYG{o}{/}\PYG{n}{lb}\PYG{o}{/}\PYG{l+m+mi}{60}\PYG{n}{d341098f40bb114c4e34b2}\PYG{o}{/}\PYG{n}{json}
\end{sphinxVerbatim}

\sphinxAtStartPar
You will get a response that looks something like this:

\sphinxAtStartPar
\sphinxincludegraphics[width=0.750\linewidth]{{dreamlo4}.png}

\sphinxAtStartPar
Here it is with nicer indentation:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}dreamlo\PYGZdq{}}\PYG{p}{:}
  \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}leaderboard\PYGZdq{}}\PYG{p}{:}
    \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}entry\PYGZdq{}}\PYG{p}{:}
      \PYG{p}{[}
        \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}name\PYGZdq{}}\PYG{p}{:}\PYG{l+s+s2}{\PYGZdq{}Carmine\PYGZdq{}}\PYG{p}{,}\PYG{n+nt}{\PYGZdq{}score\PYGZdq{}}\PYG{p}{:}\PYG{l+s+s2}{\PYGZdq{}100\PYGZdq{}}\PYG{p}{,}\PYG{n+nt}{\PYGZdq{}seconds\PYGZdq{}}\PYG{p}{:}\PYG{l+s+s2}{\PYGZdq{}0\PYGZdq{}}\PYG{p}{\PYGZcb{},}
        \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}name\PYGZdq{}}\PYG{p}{:}\PYG{l+s+s2}{\PYGZdq{}Bob\PYGZdq{}}\PYG{p}{,}\PYG{n+nt}{\PYGZdq{}score\PYGZdq{}}\PYG{p}{:}\PYG{l+s+s2}{\PYGZdq{}10\PYGZdq{}}\PYG{p}{,}\PYG{n+nt}{\PYGZdq{}seconds\PYGZdq{}}\PYG{p}{:}\PYG{l+s+s2}{\PYGZdq{}0\PYGZdq{}}\PYG{p}{\PYGZcb{}}
      \PYG{p}{]}
    \PYG{p}{\PYGZcb{}}
  \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}

\sphinxAtStartPar
This is just plain text, but it is formatted in a format called \sphinxstyleemphasis{JSON}
which makes it easy for us to write a program that processes. The names
of the objects are important and we will need them later. Also note that
curly brackets mean objects and square brackets mean lists/arrays.


\section{Submitting scores programmatically}
\label{\detokenize{tutorial:submitting-scores-programmatically}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Open the \sphinxstylestrong{gameover.tscn} scene. Right click on the root node and
add a child node. Choose \sphinxstylestrong{HTTPRequest} as the kind of node.

\item {} 
\sphinxAtStartPar
Open \sphinxstylestrong{gameover.gd} script and change the
\sphinxstylestrong{on\_LineEdit\_text\_entered} function so it looks like this (3 new
lines):

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
func \PYGZus{}on\PYGZus{}LineEdit\PYGZus{}text\PYGZus{}entered(new\PYGZus{}text):
    Globals.scores.append(Globals.score)
    Globals.names.append(new\PYGZus{}text)
    Globals.save\PYGZus{}scores()
    var url = \PYGZdq{}http://dreamlo.com/lb/\PYGZdq{}+Globals.private\PYGZus{}code+\PYGZdq{}/add/\PYGZdq{}
    url += new\PYGZus{}text.percent\PYGZus{}encode()+\PYGZdq{}/\PYGZdq{}+str(Globals.score)
    \PYGZdl{}HTTPRequest.request(url)
    get\PYGZus{}tree().change\PYGZus{}scene(\PYGZdq{}res://score\PYGZus{}table.tscn\PYGZdq{})
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{2}
\item {} 
\sphinxAtStartPar
If you run this, play the game and submit a score, it will appear to
work. However networking coding is tricksy.

\sphinxAtStartPar
In your web browser, open the URL that you used previously to get the
high s core table in JSON format. (For me this is
\sphinxstyleemphasis{http://dreamlo.com/lb/60d206118b114c4ca743/json} but your public
code will be different.)

\sphinxAtStartPar
You will probably find the score was not added. Why not? Because we
changed the scene without waiting for the network request to finish.
How long do we have to wait? It depends on the network speed. So we
will next use a \sphinxstyleemphasis{callback function} that is called for us by Godot
when the request is completed.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{DELETE} this line from the \sphinxstylestrong{on\_LineEdit\_text\_entered} function.

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{get\PYGZus{}tree}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{change\PYGZus{}scene}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{res://score\PYGZus{}table.tscn}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{4}
\item {} 
\sphinxAtStartPar
Click on the \sphinxstylestrong{HTTPRequest} node. Click \sphinxstyleemphasis{Node} next to \sphinxstyleemphasis{Inspector}
on the right to view the \sphinxstylestrong{Signals}. Double click the
\sphinxstylestrong{request\_complated} signal. Press \sphinxstyleemphasis{connect}.

\sphinxAtStartPar
Edit the function it generates to look like this:

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{func} \PYG{n}{\PYGZus{}on\PYGZus{}HTTPRequest\PYGZus{}request\PYGZus{}completed}\PYG{p}{(}\PYG{n}{result}\PYG{p}{,} \PYG{n}{response\PYGZus{}code}\PYG{p}{,} \PYG{n}{headers}\PYG{p}{,} \PYG{n}{body}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{get\PYGZus{}tree}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{change\PYGZus{}scene}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{res://score\PYGZus{}table.tscn}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{5}
\item {} 
\sphinxAtStartPar
Play the game, submit a score, and check it is added to dreamlo’s
JSON data in the web browser.

\end{enumerate}


\section{Downloading the scores programmatically}
\label{\detokenize{tutorial:downloading-the-scores-programmatically}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Create a new scene.

\item {} 
\sphinxAtStartPar
Select \sphinxstylestrong{User Interface} for the root node.

\item {} 
\sphinxAtStartPar
Rename the root node to \sphinxcode{\sphinxupquote{OnlineScoreTable}}.

\item {} 
\sphinxAtStartPar
Save the scene as \sphinxcode{\sphinxupquote{online\_score\_table.tscn}}.

\item {} 
\sphinxAtStartPar
Add a \sphinxstylestrong{Label} child node to the root node.
\begin{itemize}
\item {} 
\sphinxAtStartPar
Rename it to \sphinxcode{\sphinxupquote{Names}}

\item {} 
\sphinxAtStartPar
In the Inspector, click \sphinxstylestrong{Custom Fonts} and then drag the
\sphinxcode{\sphinxupquote{font.tres}} file from the FileSystem (bottom left of screen)
into the \sphinxcode{\sphinxupquote{{[}empty{]}}} font field.

\end{itemize}

\item {} 
\sphinxAtStartPar
Add a \sphinxstylestrong{Label} child node to the root node.
\begin{itemize}
\item {} 
\sphinxAtStartPar
Rename it to \sphinxcode{\sphinxupquote{Scores}}

\item {} 
\sphinxAtStartPar
In the Inspector, click \sphinxstylestrong{Custom Fonts} and then drag the
\sphinxstylestrong{font.tres} file from the FileSystem (bottom left of screen)
into the \sphinxstylestrong{{[}empty{]}} font field.

\end{itemize}

\item {} 
\sphinxAtStartPar
Position the two labels side by side like this:

\end{enumerate}

\sphinxAtStartPar
\sphinxincludegraphics[width=0.500\linewidth]{{tablenames}.png} \sphinxincludegraphics[width=0.500\linewidth]{{tablescores}.png}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{6}
\item {} 
\sphinxAtStartPar
Right click on the root node and add a child node. Choose
\sphinxstylestrong{HTTPRequest} as the kind of node.

\item {} 
\sphinxAtStartPar
Right click on the root node and \sphinxstylestrong{Attach script}. Press \sphinxstylestrong{create}.
Edit the ready function so it looks like this:

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{func} \PYG{n}{\PYGZus{}ready}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
  \PYG{o}{\PYGZdl{}}\PYG{n}{HTTPRequest}\PYG{o}{.}\PYG{n}{request}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{http://dreamlo.com/lb/}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{+}\PYG{n}{Globals}\PYG{o}{.}\PYG{n}{public\PYGZus{}code}\PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/json}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{8}
\item {} 
\sphinxAtStartPar
Click on the \sphinxstylestrong{HTTPRequest} node. Click \sphinxstyleemphasis{Node} next to \sphinxstyleemphasis{Inspector}
on the right to view the \sphinxstylestrong{Signals}. Double click the
\sphinxstylestrong{request\_complated} signal. Press \sphinxstylestrong{connect}.

\sphinxAtStartPar
Edit the function it generates to look like this:

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{func} \PYG{n}{\PYGZus{}on\PYGZus{}HTTPRequest\PYGZus{}request\PYGZus{}completed}\PYG{p}{(}\PYG{n}{result}\PYG{p}{,} \PYG{n}{response\PYGZus{}code}\PYG{p}{,} \PYG{n}{headers}\PYG{p}{,} \PYG{n}{body}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{var} \PYG{n}{json}  \PYG{o}{=} \PYG{n}{JSON}\PYG{o}{.}\PYG{n}{parse}\PYG{p}{(}\PYG{n}{body}\PYG{o}{.}\PYG{n}{get\PYGZus{}string\PYGZus{}from\PYGZus{}utf8}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{var} \PYG{n}{scores} \PYG{o}{=} \PYG{n}{json}\PYG{o}{.}\PYG{n}{result}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{dreamlo}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{leaderboard}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{entry}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n}{scores}\PYG{p}{:}
        \PYG{o}{\PYGZdl{}}\PYG{n}{Names}\PYG{o}{.}\PYG{n}{text} \PYG{o}{+=} \PYG{n}{i}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{name}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{\PYGZsq{}}
        \PYG{o}{\PYGZdl{}}\PYG{n}{Scores}\PYG{o}{.}\PYG{n}{text} \PYG{o}{+=} \PYG{n}{i}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{score}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{\PYGZsq{}}
\end{sphinxVerbatim}

\sphinxAtStartPar
Note how we needed the field names from the JSON output in order to tell
Godot how to pull out the data from the text and put it in a list for
us.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{9}
\item {} 
\sphinxAtStartPar
Go to the \sphinxstylestrong{title\_screen.tscn} scene.

\item {} 
\sphinxAtStartPar
Right click on the \sphinxstylestrong{VBoxContainer} node and add a \sphinxstylestrong{Button} child
node.
\begin{itemize}
\item {} 
\sphinxAtStartPar
Rename it to \sphinxcode{\sphinxupquote{OnlineHighScoreButton}}.

\item {} 
\sphinxAtStartPar
In the Inspector, enter into the \sphinxstylestrong{Text} field: \sphinxstylestrong{ONLINE
SCORES}.

\item {} 
\sphinxAtStartPar
In the Inspector, click \sphinxstylestrong{Custom Fonts} and then drag the
\sphinxcode{\sphinxupquote{font.tres}} file from the FileSystem (bottom left of screen)
into the \sphinxcode{\sphinxupquote{{[}empty{]}}} font field.

\end{itemize}

\item {} 
\sphinxAtStartPar
Click on \sphinxstyleemphasis{Node} to the right of the \sphinxstyleemphasis{Inspector} to view the
\sphinxstylestrong{Signals}. Double click on \sphinxstylestrong{pressed}. Press \sphinxstylestrong{connect}.

\sphinxAtStartPar
Edit the function that is created to look like this:

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{func} \PYG{n}{\PYGZus{}on\PYGZus{}OnlineHighScoresButton\PYGZus{}pressed}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{get\PYGZus{}tree}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{change\PYGZus{}scene}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{res://online\PYGZus{}score\PYGZus{}table.tscn}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{12}
\item {} 
\sphinxAtStartPar
Run the game and test.

\end{enumerate}


\section{Error handling}
\label{\detokenize{tutorial:error-handling}}
\sphinxAtStartPar
When you run this it may work, but it may also crash.

\sphinxAtStartPar
Why? Because there are several possible responses the server could send
you, and you don’t know which you are going to get.
\begin{itemize}
\item {} 
\sphinxAtStartPar
There could be an error on the server or network that prevents
getting any response at all.

\item {} 
\sphinxAtStartPar
You could get a response that does not contain data in the JSON
format you were expecting.

\item {} 
\sphinxAtStartPar
You could get a response that contains no scores, because no\sphinxhyphen{}one has
played the game yet.

\item {} 
\sphinxAtStartPar
You could get a response that is just a single score, because only
one person has played the game.

\item {} 
\sphinxAtStartPar
You could get a response that is a list of scores.

\end{itemize}

\sphinxAtStartPar
Ideally we would write code to handle all of these possibilities, so
that our game doesn’t crash unexpectedly.

\sphinxAtStartPar
For now, we are just going to do three basic error checks and \sphinxcode{\sphinxupquote{return}}
if there is an error. Note that we consider there being one single score
to be an error, so \sphinxstylestrong{you must submit two or more scores before this will
display anything on the screen}.

\sphinxAtStartPar
Edit the function so that it looks like this:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{func} \PYG{n}{\PYGZus{}on\PYGZus{}HTTPRequest\PYGZus{}request\PYGZus{}completed}\PYG{p}{(}\PYG{n}{result}\PYG{p}{,} \PYG{n}{response\PYGZus{}code}\PYG{p}{,} \PYG{n}{headers}\PYG{p}{,} \PYG{n}{body}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{if} \PYG{n}{result} \PYG{o}{!=} \PYG{n}{HTTPRequest}\PYG{o}{.}\PYG{n}{RESULT\PYGZus{}SUCCESS}\PYG{p}{:}
        \PYG{k}{return}
    \PYG{k}{var} \PYG{n}{json}  \PYG{o}{=} \PYG{n}{JSON}\PYG{o}{.}\PYG{n}{parse}\PYG{p}{(}\PYG{n}{body}\PYG{o}{.}\PYG{n}{get\PYGZus{}string\PYGZus{}from\PYGZus{}utf8}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{if} \PYG{n}{json}\PYG{o}{.}\PYG{n}{error} \PYG{o}{!=} \PYG{n}{OK}\PYG{p}{:}
        \PYG{k}{return}
    \PYG{k}{var} \PYG{n}{scores} \PYG{o}{=} \PYG{n}{json}\PYG{o}{.}\PYG{n}{result}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{dreamlo}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{leaderboard}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{entry}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}
    \PYG{k}{if} \PYG{o+ow}{not} \PYG{n}{scores} \PYG{k}{is} \PYG{n+nb+nbType}{Array}\PYG{p}{:}
        \PYG{k}{return}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n}{scores}\PYG{p}{:}
        \PYG{o}{\PYGZdl{}}\PYG{n}{Names}\PYG{o}{.}\PYG{n}{text} \PYG{o}{+=} \PYG{n}{i}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{name}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{\PYGZsq{}}
        \PYG{o}{\PYGZdl{}}\PYG{n}{Scores}\PYG{o}{.}\PYG{n}{text} \PYG{o}{+=} \PYG{n}{i}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{score}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{\PYGZsq{}}
\end{sphinxVerbatim}


\section{Challenges}
\label{\detokenize{tutorial:challenges}}
\sphinxAtStartPar
Show the user what is going on. Display \sphinxstylestrong{Downloading Scores} when the
scene loads, and then display \sphinxstylestrong{Scores Downloaded} when they have
downloaded successfully. If one of the errors happens, display what the
error is.

\sphinxAtStartPar
Handle the case when the table contains only one score. Hint:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{if} \PYG{n}{scores} \PYG{k}{is} \PYG{n+nb+nbType}{Dictionary}\PYG{p}{:}
    \PYG{o}{\PYGZdl{}}\PYG{n}{Names}\PYG{o}{.}\PYG{n}{text} \PYG{o}{==} \PYG{n}{scores}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{name}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}
\end{sphinxVerbatim}

\sphinxAtStartPar
Add additional error checks. For example, what would happen if the JSON
did not contain an entry for \sphinxcode{\sphinxupquote{leaderboard}}?

\sphinxAtStartPar
Dreamlo also allows a time to be submitted along with the score. This is
useful for games with a timer. Submit times for your game.



\renewcommand{\indexname}{Index}
\printindex
\end{document}